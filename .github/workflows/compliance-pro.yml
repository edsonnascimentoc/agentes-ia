name: ğŸ›¡ï¸ Compliance Corporativo â€” SeguranÃ§a e Qualidade

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  seguranÃ§a-e-privacidade:
    name: ğŸ” ValidaÃ§Ã£o de LGPD, tokens e segredos
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Instalar dependÃªncias
        run: |
          python -m pip install --upgrade pip
          pip install jsonschema pytest

      - name: ğŸ§ª Executar validaÃ§Ã£o de seguranÃ§a
        run: |
          echo "Validando estrutura de agentes (schema)..."
          pytest tests/test_agentes.py

          echo "Verificando segredos e dados sensÃ­veis..."
          python compliance/valida_compliance.py agents/estrutura_agentes_v1.json

      - name: âœ… Conformidade aprovada
        if: success()
        run: echo "Pipeline passou com sucesso. Nenhum dado sensÃ­vel ou violaÃ§Ã£o encontrada."

      - name: âŒ Falha de seguranÃ§a
        if: failure()
        run: echo "âš ï¸ Compliance falhou. Corrija os problemas antes de prosseguir."
